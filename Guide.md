后端自动化开发流程规范（面向AI Agent）
本文档旨在指导AI agent在参与后端项目开发时遵循统一的流程、规范和检查点，以确保开发过程流畅、代码质量可靠、返工率最低。agent需严格按照以下步骤和规则执行。

1. 开发准备
环境配置：确保开发环境已配置好JDK、Maven/Gradle、Git、Docker（如有）、数据库连接等。

项目克隆：从主仓库克隆代码，并确保能成功构建。

需求理解：获取需求文档（PRD）和技术设计文档，理解功能需求和约束。

2. 分支管理
主分支：main 为生产稳定分支，禁止直接推送。

开发分支：develop 为集成分支，所有功能分支由此切出并合并。

功能分支：命名格式 feature/xxx，其中xxx为需求ID或简短描述。

修复分支：bugfix/xxx 用于线上紧急修复。

分支生命周期：分支完成开发、测试、审查并合并后，需删除远程分支。

3. 代码提交规范（原子化提交）
每次提交应只包含一个逻辑修改，便于回溯和审查。

3.1 提交前检查
代码风格：运行代码格式化工具（如Spotless、Prettier）确保符合团队规范。

静态分析：运行SonarQube或Checkstyle，修复阻塞性问题。

单元测试：编写或更新单元测试，确保新增代码有测试覆盖，且所有测试通过。

本地构建：完整构建项目，确保无编译错误。

3.2 提交信息格式
必须遵循以下格式：

text
<type>(<scope>): <subject>

<body>
type：feat（新功能）、fix（修复）、docs（文档）、style（格式）、refactor（重构）、test（测试）、chore（构建/工具）

scope：影响模块（如user-service、order-api），可选

subject：简短描述，不超过50字符，使用英文或中文

body：详细描述，可包含修改原因、影响、关联的Issue ID（如 Closes #123）

示例：

text
feat(user): add phone number login

- Implement phone+code login API
- Add verification code cache in Redis
- Closes #45
3.3 提交频率
鼓励频繁提交，每个功能点完成后及时提交。

禁止累积大量修改后一次性提交。

4. 测试要求
4.1 单元测试
核心业务逻辑必须编写单元测试，覆盖率不低于80%。

使用JUnit、Mockito等框架，测试应独立、可重复运行。

在提交前运行 mvn test 或 gradle test，确保全部通过。

4.2 集成测试
涉及外部服务（数据库、Redis、MQ）的代码需编写集成测试，使用Testcontainers或嵌入式服务。

集成测试应在CI环境中运行，失败则阻止合并。

4.3 冒烟测试
修改后需手动或自动运行核心流程的冒烟测试，确保主流程（Happy Path）和关键异常流程（Unhappy Path）正常。

冒烟测试用例需在需求文档中定义，并定期更新。

5. 接口文档
API接口文档使用OpenAPI（Swagger）规范，自动生成或手动维护。

每次修改API（包括新增、修改字段、修改响应码等），必须同步更新Swagger注解或YAML文件。

agent在开发完成后，需检查接口文档是否与实现一致。

6. 数据库变更
所有表结构变更需编写数据库迁移脚本（如Flyway、Liquibase），并放置在指定目录。

脚本命名规则：V<版本>__<描述>.sql，版本为时间戳或顺序号。

脚本需包含回滚语句（或提供回滚脚本）。

提交前需在本地数据库验证脚本可正确执行和回滚。

7. 代码审查与合并
完成功能开发后，agent需创建Pull Request（PR）或Merge Request（MR）到develop分支。

PR描述应包含：

变更概述

测试步骤（如何验证）

影响范围

关联需求/缺陷链接

自测截图或日志（可选）

审查者：可以是人类或另一个agent，需检查：

代码质量、架构符合性

测试覆盖率、CI结果

提交历史是否清晰

文档是否同步更新

只有审查通过且CI全部成功后，才能合并。

合并后需删除远程分支。

8. 自动化流水线（CI/CD）
CI流水线（如GitHub Actions、Jenkins）应自动执行以下步骤：

代码检出

编译构建

运行单元测试和集成测试

静态代码分析（SonarQube）

构建Docker镜像（如有）

部署到测试环境（可选）

通知审查者

agent需确保每次推送都能触发CI，并及时处理失败。

9. 异常处理与技术债务
代码中禁止遗留未处理的TODO或FIXME。如需遗留，必须附带Issue链接并排期处理。

异常捕获需合理，避免吞没异常或打印堆栈后不处理。

关键路径需考虑降级、熔断、重试机制（如使用Resilience4j、Sentinel）。

10. 最终交付检查清单
在发起PR前，agent应自行对照以下清单：

代码已格式化，无编译错误

所有测试（单元、集成）通过

新增代码有单元测试覆盖

接口文档已更新（Swagger/YAML）

数据库迁移脚本已添加，且可回滚

提交历史符合原子化规范

无未处理的TODO/FIXME

已进行本地冒烟测试

PR描述完整

说明：本文档为AI agent参与后端开发的操作指南，所有步骤需严格遵守。如有疑问，可请求人类干预。agent在执行过程中应自动调用相关工具（如Git命令、构建工具、测试框架）完成各项任务。